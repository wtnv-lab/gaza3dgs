AddDefaultCharset UTF-8

<IfModule mod_deflate.c>
    # ----------------------------------------------------------------
    # 【重要】Base64埋め込みHTMLのための追加設定
    # ----------------------------------------------------------------
    
    # 圧縮レベルを最大（1～9）に設定します。
    # Base64で肥大化したファイルの転送サイズを最小限に抑えるのに有効です。
    DeflateCompressionLevel 9

    # ----------------------------------------------------------------
    # 基本設定
    # ----------------------------------------------------------------

    # 1. .ply拡張子の定義（外部ファイルとして使う場合用）
    AddType application/ply .ply

    # 圧縮を有効にする
    SetOutputFilter DEFLATE

    # 古いブラウザ対策
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

    # 画像（すでに圧縮済み）や動画は再圧縮しない
    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png|ico|zip|gz|mp4)$ no-gzip dont-vary

    # ----------------------------------------------------------------
    # 圧縮対象のMIMEタイプ指定
    # ----------------------------------------------------------------

    # ★ここが最重要です：HTMLファイルを圧縮対象にします
    AddOutputFilterByType DEFLATE text/html
    
    # その他のテキスト形式も圧縮
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE image/svg+xml
    AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
    AddOutputFilterByType DEFLATE font/ttf
    AddOutputFilterByType DEFLATE font/otf
    AddOutputFilterByType DEFLATE font/x-woff
    
    # .plyファイル（外部読み込み時）も圧縮
    AddOutputFilterByType DEFLATE application/ply

    # プロキシサーバー対策
    <IfModule mod_headers.c>
        Header append Vary User-Agent env=!dont-vary
    </IfModule>

</IfModule>