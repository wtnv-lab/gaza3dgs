AddDefaultCharset UTF-8

# 1. .ply拡張子を定義
AddType application/ply .ply

# ----------------------------------------------------------------
# Brotli 圧縮設定
# ----------------------------------------------------------------
<IfModule mod_brotli.c>
    # ★削除しました: BrotliCompressionQuality (ここは記述不可のため)
    # すでにサーバー設定(/etc/httpd/conf.d/brotli.conf)で設定済みなので問題ありません。

    # 圧縮対象を指定
    AddOutputFilterByType BROTLI_COMPRESS text/html text/plain text/xml text/css
    AddOutputFilterByType BROTLI_COMPRESS application/javascript application/json
    AddOutputFilterByType BROTLI_COMPRESS application/ply application/xml
    AddOutputFilterByType BROTLI_COMPRESS image/svg+xml
    AddOutputFilterByType BROTLI_COMPRESS application/x-javascript text/javascript
    AddOutputFilterByType BROTLI_COMPRESS application/vnd.ms-fontobject font/ttf font/otf font/x-woff
</IfModule>

# ----------------------------------------------------------------
# Gzip (Deflate) 圧縮設定 (バックアップ)
# ----------------------------------------------------------------
<IfModule mod_deflate.c>
    # SetOutputFilter DEFLATE は削除済み（Brotliを優先するため）

    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png|ico|zip|gz|mp4)$ no-gzip dont-vary

    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
    AddOutputFilterByType DEFLATE application/javascript application/json
    AddOutputFilterByType DEFLATE application/ply application/xml
    AddOutputFilterByType DEFLATE image/svg+xml
    AddOutputFilterByType DEFLATE application/x-javascript text/javascript
    AddOutputFilterByType DEFLATE application/vnd.ms-fontobject font/ttf font/otf font/x-woff

    <IfModule mod_headers.c>
        Header append Vary User-Agent env=!dont-vary
    </IfModule>
</IfModule>