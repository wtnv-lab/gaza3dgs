AddDefaultCharset UTF-8

# 1. .ply拡張子を定義
AddType application/ply .ply

# ----------------------------------------------------------------
# Brotli 圧縮設定 (優先度高)
# ----------------------------------------------------------------
<IfModule mod_brotli.c>
    # 圧縮レベル (必要に応じて変更可。サーバー設定が優先される場合もあります)
    BrotliCompressionQuality 6

    # 圧縮対象を指定
    AddOutputFilterByType BROTLI_COMPRESS text/html text/plain text/xml text/css
    AddOutputFilterByType BROTLI_COMPRESS application/javascript application/json
    AddOutputFilterByType BROTLI_COMPRESS application/ply application/xml
    AddOutputFilterByType BROTLI_COMPRESS image/svg+xml
    AddOutputFilterByType BROTLI_COMPRESS application/x-javascript text/javascript
    AddOutputFilterByType BROTLI_COMPRESS application/vnd.ms-fontobject font/ttf font/otf font/x-woff
</IfModule>

# ----------------------------------------------------------------
# Gzip (Deflate) 圧縮設定 (Brotli非対応ブラウザ用のバックアップ)
# ----------------------------------------------------------------
<IfModule mod_deflate.c>
    # ★重要: 以下の行をコメントアウトまたは削除しました
    # SetOutputFilter DEFLATE

    # 古いブラウザ対策
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

    # 画像などは除外
    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png|ico|zip|gz|mp4)$ no-gzip dont-vary

    # 圧縮対象を指定
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css
    AddOutputFilterByType DEFLATE application/javascript application/json
    AddOutputFilterByType DEFLATE application/ply application/xml
    AddOutputFilterByType DEFLATE image/svg+xml
    AddOutputFilterByType DEFLATE application/x-javascript text/javascript
    AddOutputFilterByType DEFLATE application/vnd.ms-fontobject font/ttf font/otf font/x-woff

    # プロキシ対策
    <IfModule mod_headers.c>
        Header append Vary User-Agent env=!dont-vary
    </IfModule>
</IfModule>