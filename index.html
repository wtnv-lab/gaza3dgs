<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <!-- ページタイトル -->
    <title>Gaza 3D Digital Archives | A UTokyo & Partners Initiative</title>

    <!-- 検索エンジン用の説明文 -->
    <meta name="description"
        content="An interactive 3D digital archive documenting the reality in Gaza, including scenes from Al Shifa Hospital and Khan Yunis. Created by the University of Tokyo and partners based on footage from Al Jazeera and UNRWA.">

    <!-- Facebook & SNS共有用のOpen Graphタグ -->
    <meta property="og:title" content="Gaza 3D Digital Archives | Witnessing Reality">
    <meta property="og:description"
        content="An interactive 3D archive of scenes from Gaza, created from Al Jazeera and UNRWA footage to preserve and convey the situation on the ground.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://gaza.archiving.jp/sns.jpg">
    <meta property="og:url" content="https://gaza.archiving.jp/index.html">
    <meta property="og:site_name" content="Gaza 3D Digital Archives">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- X (Twitter) 共有用のカードタグ -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@hwtnv">
    <meta name="twitter:creator" content="@hwtnv">
    <meta name="twitter:title" content="Gaza 3D Digital Archives | A UTokyo & Partners Initiative">
    <meta name="twitter:description"
        content="An interactive 3D archive of scenes from Gaza, created from Al Jazeera and UNRWA footage to preserve and convey the situation on the ground.">
    <meta name="twitter:image" content="https://gaza.archiving.jp/sns.jpg">

    <style>
        :root {
            --glass-bg: linear-gradient(180deg, rgba(44, 52, 64, 0.5), rgba(18, 22, 30, 0.3));
            --glass-bg-strong: linear-gradient(180deg, rgba(56, 66, 82, 0.68), rgba(18, 24, 34, 0.5));
            --glass-border: rgba(255, 255, 255, 0.12);
            --glass-border-strong: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 18px 40px rgba(0, 0, 0, 0.28);
            --glass-highlight: inset 0 1px 0 rgba(255, 255, 255, 0.08);
            --glass-text-soft: rgba(228, 236, 246, 0.82);
            --glass-accent: rgba(122, 176, 255, 0.32);
            --glass-accent-strong: rgba(122, 176, 255, 0.58);
        }

        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #1a1a1a;
            color: #f0f0f0;
            overflow: hidden;
        }

        .app-container {
            height: 100dvh;
            position: relative;
        }

        .iframe-wrapper {
            position: relative;
            border: none;
            height: 100%;
        }

        #iframe-target,
        #iframe-target iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        #controls {
            position: absolute;
            left: 14px;
            right: 14px;
            bottom: 14px;
            z-index: 950;
            display: flex;
            align-items: center;
            padding: 6px 10px 7px;
            background:
                linear-gradient(180deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0)),
                linear-gradient(180deg, rgba(28, 34, 44, 0.28), rgba(12, 16, 22, 0.18));
            border: 1px solid rgba(255, 255, 255, 0.08);
            gap: 10px;
            -webkit-backdrop-filter: blur(22px) saturate(140%);
            backdrop-filter: blur(22px) saturate(140%);
            box-shadow: 0 16px 34px rgba(0, 0, 0, 0.18), var(--glass-highlight);
        }

        #content-buttons-wrapper {
            flex: 1;
            min-width: 0;
            overflow-x: auto;
            white-space: nowrap;
            text-align: center;
            scrollbar-width: thin;
            scrollbar-color: rgba(200, 220, 255, 0.38) transparent;
        }

        #content-buttons-wrapper::-webkit-scrollbar {
            height: 8px;
        }

        #content-buttons-wrapper::-webkit-scrollbar-track {
            background: transparent;
        }

        #content-buttons-wrapper::-webkit-scrollbar-thumb {
            background-color: rgba(200, 220, 255, 0.3);
            border-radius: 4px;
        }

        #controls button {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.04));
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 7px 14px;
            margin: 0;
            border-radius: 0;
            cursor: pointer;
            font-size: 13px;
            transition: background-color 0.25s, border-color 0.25s, transform 0.25s, box-shadow 0.25s;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            -webkit-backdrop-filter: blur(18px) saturate(150%);
            backdrop-filter: blur(18px) saturate(150%);
            box-shadow: var(--glass-highlight), 0 8px 20px rgba(0, 0, 0, 0.16);
        }

        .archives-index-link {
            position: fixed;
            top: 12px;
            left: 12px;
            z-index: 1100;
            display: inline-flex;
            align-items: center;
            padding: 8px 12px;
            border: 1px solid var(--glass-border);
            border-radius: 0;
            background:
                linear-gradient(180deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.02)),
                var(--glass-bg-strong);
            -webkit-backdrop-filter: blur(18px) saturate(150%);
            backdrop-filter: blur(18px) saturate(150%);
            box-shadow: var(--glass-shadow), var(--glass-highlight);
            color: #f0f0f0;
            font-size: 12px;
            line-height: 1;
            letter-spacing: 0.02em;
            text-decoration: none;
            white-space: nowrap;
            transition: background-color 0.2s, border-color 0.2s, transform 0.2s;
        }

        .archives-index-link:hover {
            background:
                linear-gradient(180deg, rgba(255, 255, 255, 0.18), rgba(255, 255, 255, 0.04)),
                rgba(42, 52, 68, 0.78);
            border-color: var(--glass-border-strong);
            transform: translateY(-1px);
        }

        .archives-index-link:focus-visible {
            outline: 2px solid rgba(255, 255, 255, 0.8);
            outline-offset: 2px;
        }

        #controls button.active {
            background:
                linear-gradient(180deg, rgba(175, 215, 255, 0.34), rgba(84, 140, 255, 0.18)),
                rgba(26, 50, 94, 0.5);
            border-color: rgba(157, 205, 255, 0.56);
            box-shadow:
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 10px 24px rgba(35, 92, 196, 0.26);
        }

        #controls button:hover {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.22), rgba(255, 255, 255, 0.08));
            border-color: var(--glass-border-strong);
            transform: translateY(-1px);
        }

        #prev-btn,
        #next-btn {
            flex-shrink: 0;
            padding: 6px;
            min-width: 38px;
        }

        .icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        #prev-btn .icon,
        #next-btn .icon {
            width: 24px;
            height: 24px;
            stroke-width: 2.5;
        }

        #info-box {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 255px;
            background:
                linear-gradient(180deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.03)),
                var(--glass-bg-strong);
            border: 1px solid var(--glass-border);
            border-radius: 0;
            padding: 15px;
            box-shadow: var(--glass-shadow), var(--glass-highlight);
            z-index: 1000;
            max-height: calc(100% - 40px);
            overflow-y: auto;
            -webkit-backdrop-filter: blur(24px) saturate(150%);
            backdrop-filter: blur(24px) saturate(150%);
        }

        #info-box h3 {
            margin-top: 0;
            font-size: 16px;
            letter-spacing: 0.01em;
        }

        #info-box p {
            font-size: 12px;
            line-height: 1.5;
            color: var(--glass-text-soft);
        }

        #info-box #credit-display {
            margin-top: 12px;
            font-size: 10px;
            color: rgba(216, 224, 235, 0.68);
            border-top: 1px solid rgba(255, 255, 255, 0.12);
            padding-top: 8px;
        }

        #info-box #credit-display a {
            color: #a9cbff;
            text-decoration: none;
        }

        #info-box #credit-display a:hover {
            text-decoration: underline;
        }

        .mobile-ui {
            display: none;
        }

        #list-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at top, rgba(122, 176, 255, 0.12), transparent 38%),
                rgba(6, 10, 18, 0.72);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            -webkit-backdrop-filter: blur(20px) saturate(120%);
            backdrop-filter: blur(20px) saturate(120%);
        }

        #list-modal.visible {
            opacity: 1;
            visibility: visible;
        }

        #list-modal-header {
            padding: 15px;
            text-align: right;
        }

        #list-modal-close {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.04));
            border: 1px solid var(--glass-border);
            cursor: pointer;
            padding: 10px;
            border-radius: 0;
            box-shadow: var(--glass-highlight);
            -webkit-backdrop-filter: blur(18px);
            backdrop-filter: blur(18px);
        }

        #list-modal-close .icon {
            width: 30px;
            height: 30px;
            color: white;
        }

        #list-modal-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0 15px 15px;
        }

        .list-item {
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 0;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));
            color: #eee;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 10px;
            box-shadow: var(--glass-highlight);
            transition: background-color 0.2s, border-color 0.2s, transform 0.2s;
        }

        .list-item.active {
            background:
                linear-gradient(180deg, rgba(175, 215, 255, 0.3), rgba(84, 140, 255, 0.14)),
                rgba(26, 50, 94, 0.44);
            border-color: rgba(157, 205, 255, 0.4);
            color: white;
        }

        .list-item:hover {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.13), rgba(255, 255, 255, 0.05));
            border-color: rgba(255, 255, 255, 0.14);
            transform: translateY(-1px);
        }

        @media (max-width: 768px) {
            #controls {
                display: none;
            }

            .mobile-ui {
                display: flex;
                align-items: center;
                justify-content: center;
                background: none;
                border: none;
                cursor: pointer;
                color: white;
            }

            #mobile-controls {
                position: absolute;
                left: 8px;
                right: 8px;
                bottom: 8px;
                z-index: 950;
                display: grid;
                grid-template-columns: 80px 1fr 80px;
                padding: 5px;
            }

            #mobile-prev,
            #mobile-next {
                padding: 10px;
            }

            #mobile-prev .icon,
            #mobile-next .icon {
                width: 30px;
                height: 30px;
                stroke-width: 3;
            }

            #mobile-center-controls {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 5px;
            }

            #scene-counter {
                font-size: 16px;
                font-weight: bold;
            }

            /* ▼▼▼ 修正箇所 ▼▼▼ */
            #list-toggle-btn {
                padding: 8px;
                background:
                    linear-gradient(180deg, rgba(255, 255, 255, 0.16), rgba(255, 255, 255, 0.04)),
                    rgba(23, 30, 40, 0.46);
                color: white;
                border: 1px solid var(--glass-border);
                border-radius: 0;
                -webkit-backdrop-filter: blur(16px);
                backdrop-filter: blur(16px);
                box-shadow: var(--glass-highlight), 0 8px 18px rgba(0, 0, 0, 0.22);
            }

            #list-toggle-btn .icon {
                width: 28px;
                height: 28px;
            }

            #info-box {
                top: auto;
                right: 0;
                left: 0;
                width: 100%;
                bottom: -100vh;
                border-radius: 0;
                max-height: 60%;
                box-sizing: border-box;
                transition: bottom 0.3s ease-in-out;
            }

            #info-box.visible {
                bottom: 0;
            }

            #overlay-buttons {
                position: absolute;
                top: 15px;
                right: 15px;
                display: flex;
                flex-direction: column;
                gap: 15px;
                z-index: 900;
            }

            #info-toggle-btn,
            #fullscreen-btn {
                width: 44px;
                height: 44px;
                border-radius: 0;
                background:
                    linear-gradient(180deg, rgba(255, 255, 255, 0.14), rgba(255, 255, 255, 0.04)),
                    rgba(20, 28, 38, 0.42);
                border: 1px solid var(--glass-border);
                -webkit-backdrop-filter: blur(14px);
                backdrop-filter: blur(14px);
                box-shadow: var(--glass-highlight), 0 8px 18px rgba(0, 0, 0, 0.18);
            }

            #info-toggle-btn .icon,
            #fullscreen-btn .icon {
                width: 22px;
                height: 22px;
            }

            #fullscreen-btn {
                display: none;
            }

            .archives-index-link {
                display: none;
            }
        }
    </style>
</head>

<body>
    <!-- HTML構造は変更ありません -->
    <a class="archives-index-link" href="https://all.archiving.jp/" target="_blank" rel="noopener noreferrer"
        aria-label="Archives Index">
        <span>Archives Index</span>
    </a>
    <div class="app-container">
        <div class="iframe-wrapper">
            <div id="iframe-target"></div>
            <div id="info-box">
                <h3 id="info-title"></h3>
                <p id="info-description"></p>
                <div id="credit-display"></div>
            </div>
            <div id="overlay-buttons" class="mobile-ui">
                <button id="info-toggle-btn" title="Info"><svg viewBox="0 0 24 24" class="icon">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg></button>
                <button id="fullscreen-btn" title="Fullscreen"><svg viewBox="0 0 24 24" class="icon">
                        <path
                            d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3">
                        </path>
                    </svg></button>
            </div>
        </div>
        <div id="controls">
            <button id="prev-btn" title="Previous (Left Arrow)"><svg viewBox="0 0 24 24" class="icon">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg></button>
            <div id="content-buttons-wrapper"></div>
            <button id="next-btn" title="Next (Right Arrow)"><svg viewBox="0 0 24 24" class="icon">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg></button>
        </div>
        <div id="mobile-controls" class="mobile-ui">
            <button id="mobile-prev" class="mobile-ui"><svg viewBox="0 0 24 24" class="icon">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg></button>
            <div id="mobile-center-controls" class="mobile-ui">
                <span id="scene-counter"></span>
                <button id="list-toggle-btn" title="Show List"><svg viewBox="0 0 24 24" class="icon">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg></button>
            </div>
            <button id="mobile-next" class="mobile-ui"><svg viewBox="0 0 24 24" class="icon">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg></button>
        </div>
    </div>
    <div id="list-modal">
        <div id="list-modal-header">
            <button id="list-modal-close"><svg viewBox="0 0 24 24" class="icon">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg></button>
        </div>
        <div id="list-modal-content"></div>
    </div>

    <script>
        /**
         * アプリケーション全体を管理するモジュール
         */
        const App = (() => {

            // --- 1. 定数とデータ ---
            // 【修正点】データを見やすく整形
            const contentData = [
                {
                    title: "People in Al Shifa Courtyard",
                    description: "This 3D model shows displaced Palestinians receiving care in the courtyard of Al Shifa Hospital. Following repeated Israeli military raids, the hospital's main wards were severely damaged or destroyed, forcing patients and medical staff to use outdoor spaces for treatment.",
                    src: "https://www.kiriengine.app/share/3dgsEmbed/1885843519059263488?userId=undefined?&bg_theme=dark",
                    credit: "© UTokyo & Al Jazeera",
                    needsReload: true,
                    reloadSeconds: 26
                },
                {
                    title: "Al Shifa Hospital Courtyard",
                    description: "A view of the parking area within the Al Shifa Hospital courtyard, showing destroyed vehicles. The extensive damage to the complex illustrates the intensity of the attacks it sustained, which ultimately left Gaza's largest hospital non-functional.",
                    src: "https://www.kiriengine.app/share/3dgsEmbed/1850871041102970880?userId=undefined?&bg_theme=dark",
                    credit: "© UTokyo & Al Jazeera",
                    needsReload: true,
                    reloadSeconds: 26
                },
                {
                    title: "Destroyed Entrance of Al Shifa Hospital",
                    description: "This model captures the devastated main entrance and interior of Al Shifa Hospital. The scene reflects the aftermath of intense fighting and bombardment that left the medical facility in ruins.",
                    src: "https://www.kiriengine.app/share/3dgsEmbed/1850870603406376960?userId=undefined?&bg_theme=dark",
                    credit: "© UTokyo & Al Jazeera",
                    needsReload: true,
                    reloadSeconds: 26
                },
                {
                    title: "Newborns Huddled for Care at Al Shifa",
                    description: "This model shows several premature babies sharing a single bed for warmth and care at Al Shifa Hospital. Their specialized incubators became unusable due to power cuts and damage from military operations, forcing medical staff to improvise to keep them alive.",
                    src: "https://lumalabs.ai/embed/433cd331-1f50-4077-8d77-34ef4173bd9e?mode=sparkles&background=%23ffffff&color=%23000000&showTitle=false&loadBg=true&logoPosition=bottom-left&infoPosition=bottom-right&cinematicVideo=undefined&showMenu=false",
                    credit: "© UTokyo & Al Jazeera",
                    needsReload: false
                },
                {
                    title: "Premature Babies in Improvised Care",
                    description: "This model shows several premature babies sharing a single bed for warmth and care at Al Shifa Hospital. Their specialized incubators became unusable due to power cuts and damage from military operations, forcing medical staff to improvise to keep them alive.",
                    src: "https://lumalabs.ai/embed/af474206-210c-43b7-bcf7-f963d6b04900?mode=sparkles&background=%23ffffff&color=%23000000&showTitle=false&loadBg=true&logoPosition=bottom-left&infoPosition=bottom-right&cinematicVideo=undefined&showMenu=false",
                    credit: "© UTokyo & Al Jazeera",
                    needsReload: false
                },
                {
                    title: "Abandoned Nursery at Al Shifa Hospital",
                    description: "The neonatal intensive care unit (NICU) at Al Shifa Hospital, now empty and non-functional. This room, once filled with life-saving equipment, stands as a stark testament to the collapse of the healthcare system in Gaza's largest hospital.",
                    src: "https://lumalabs.ai/embed/8408d73d-04dc-4f6d-92f5-5efd2b3af5d0?mode=sparkles&background=%23ffffff&color=%23000000&showTitle=false&loadBg=true&logoPosition=bottom-left&infoPosition=bottom-right&cinematicVideo=undefined&showMenu=false",
                    credit: "© UTokyo & Al Jazeera",
                    needsReload: false
                },
                {
                    title: "Destroyed UN Vehicle in Bureij Camp",
                    description: "A destroyed United Nations (UN) vehicle in the Bureij refugee camp. The original footage from UNRWA shows the aftermath of an attack on an aid convoy, highlighting the perilous conditions for humanitarian workers in the Gaza Strip.",
                    src: "https://www.kiriengine.app/share/3dgsEmbed/1863133701328601088?userId=undefined?&bg_theme=bright",
                    credit: '© UTokyo & <a href="https://www.instagram.com/p/C6b8L0pI-Sv/" target="_blank">UNRWA</a>',
                    needsReload: true,
                    reloadSeconds: 26
                },
                {
                    title: "Destroyed Cityscape in Khan Yunis",
                    description: "Widespread destruction in the city of Khan Yunis. This scene, captured by UNRWA, documents the extensive damage to residential buildings and urban infrastructure following prolonged Israeli military operations in the southern Gaza Strip.",
                    src: "https://www.kiriengine.app/share/3dgsEmbed/1863739985128062976?userId=undefined?&bg_theme=dark",
                    credit: "© UTokyo & UNRWA",
                    needsReload: true,
                    reloadSeconds: 26
                },
                {
                    title: "Rubble and Ruins in Khan Yunis",
                    description: "Another view of the devastation in Khan Yunis. The sheer scale of the destruction has made large parts of the city uninhabitable, creating a massive humanitarian and reconstruction challenge for the future.",
                    src: "https://www.kiriengine.app/share/3dgsEmbed/1863737783344955392?userId=undefined?&bg_theme=dark",
                    credit: "© UTokyo & UNRWA",
                    needsReload: true,
                    reloadSeconds: 26
                },
                {
                    title: "Japan-Funded Overpass in Khan Yunis",
                    description: "An overpass in Khan Yunis, built with development aid from the government of Japan. A sign on the bridge, written in Japanese, expresses gratitude for the support. This infrastructure was intended to improve local transportation and stood as a symbol of friendship before the recent conflict.",
                    src: "https://lumalabs.ai/embed/6e0ba4f5-6a08-42ae-b048-9ddd9f801c98?mode=sparkles&background=%23ffffff&color=%23000000&showTitle=false&loadBg=true&logoPosition=bottom-left&infoPosition=top-left&cinematicVideo=undefined&showMenu=false",
                    credit: '© UTokyo & <a href="https://www.unrwa.org/" target="_blank">UNRWA</a>',
                    needsReload: false
                }
            ];

            // --- 2. 状態管理 ---
            // (変更なし)
            const state = {
                currentIndex: 0,
                reloadTimer: null,
                touchStartX: 0,
                touchStartY: 0
            };

            // --- 3. DOM要素のキャッシュ ---
            // (変更なし)
            const DOM = {
                iframeWrapper: document.querySelector('.iframe-wrapper'),
                iframeTarget: document.getElementById('iframe-target'),
                infoBox: document.getElementById('info-box'),
                infoTitle: document.getElementById('info-title'),
                infoDescription: document.getElementById('info-description'),
                creditDisplay: document.getElementById('credit-display'),
                contentButtonsWrapper: document.getElementById('content-buttons-wrapper'),
                prevBtn: document.getElementById('prev-btn'),
                nextBtn: document.getElementById('next-btn'),
                mobilePrevBtn: document.getElementById('mobile-prev'),
                mobileNextBtn: document.getElementById('mobile-next'),
                sceneCounter: document.getElementById('scene-counter'),
                listToggleBtn: document.getElementById('list-toggle-btn'),
                infoToggleBtn: document.getElementById('info-toggle-btn'),
                fullscreenBtn: document.getElementById('fullscreen-btn'),
                listModal: document.getElementById('list-modal'),
                listModalContent: document.getElementById('list-modal-content'),
                listModalClose: document.getElementById('list-modal-close')
            };

            // --- 4. コア機能 ---
            // (変更なし)
            const _recreateIframe = (src) => {
                const oldIframe = DOM.iframeTarget.firstChild;
                if (oldIframe) {
                    oldIframe.src = 'about:blank';
                    try { DOM.iframeTarget.removeChild(oldIframe); } catch (e) { }
                }
                setTimeout(() => {
                    const newIframe = document.createElement('iframe');
                    newIframe.title = "3DGS Content";
                    newIframe.setAttribute('allow', 'autoplay; fullscreen');
                    newIframe.setAttribute('execution-while-out-of-viewport', '');
                    newIframe.setAttribute('execution-while-not-rendered', '');
                    DOM.iframeTarget.appendChild(newIframe);
                    newIframe.src = src;
                }, 50);
            };
            const _manageReloadTimer = () => {
                if (state.reloadTimer) { clearInterval(state.reloadTimer); state.reloadTimer = null; }
                const currentContent = contentData[state.currentIndex];
                if (document.hidden || !currentContent.needsReload) { return; }
                state.reloadTimer = setInterval(() => { _recreateIframe(currentContent.src); }, currentContent.reloadSeconds * 1000);
            };
            const changeContent = (index) => {
                if (index < 0 || index >= contentData.length) return;
                state.currentIndex = index;
                const data = contentData[index];
                _recreateIframe(data.src);
                _manageReloadTimer();
                DOM.infoTitle.textContent = data.title;
                DOM.infoDescription.textContent = data.description;
                DOM.creditDisplay.innerHTML = data.credit;
                _updateUI();
            };
            const navigate = (direction) => {
                const newIndex = (state.currentIndex + direction + contentData.length) % contentData.length;
                changeContent(newIndex);
            };

            // --- 5. UI更新 ---
            // (変更なし)
            const _updateUI = () => {
                const pcButtons = DOM.contentButtonsWrapper.querySelectorAll('button');
                pcButtons.forEach((button, index) => { button.classList.toggle('active', index === state.currentIndex); });
                if (pcButtons[state.currentIndex]) { pcButtons[state.currentIndex].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }); }
                const mobileListItems = DOM.listModalContent.querySelectorAll('.list-item');
                mobileListItems.forEach((item, index) => { item.classList.toggle('active', index === state.currentIndex); });
                DOM.sceneCounter.textContent = `${state.currentIndex + 1} / ${contentData.length}`;
            };

            // --- 6. イベントリスナーの設定 ---
            // (変更なし)
            const _setupEventListeners = () => {
                DOM.prevBtn.onclick = () => navigate(-1);
                DOM.nextBtn.onclick = () => navigate(1);
                DOM.mobilePrevBtn.onclick = () => navigate(-1);
                DOM.mobileNextBtn.onclick = () => navigate(1);
                DOM.infoToggleBtn.onclick = () => DOM.infoBox.classList.toggle('visible');
                DOM.listToggleBtn.onclick = () => DOM.listModal.classList.add('visible');
                DOM.listModalClose.onclick = () => DOM.listModal.classList.remove('visible');
                DOM.fullscreenBtn.onclick = () => {
                    if (!document.fullscreenElement) { document.documentElement.requestFullscreen().catch(err => console.error(err)); }
                    else { document.exitFullscreen(); }
                };
                document.addEventListener('keydown', (event) => {
                    if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
                        event.preventDefault();
                        if (document.activeElement) document.activeElement.blur();
                        navigate(event.key === 'ArrowLeft' ? -1 : 1);
                    }
                });
                DOM.iframeWrapper.addEventListener('touchstart', e => {
                    state.touchStartX = e.changedTouches[0].screenX;
                    state.touchStartY = e.changedTouches[0].screenY;
                }, { passive: true });
                DOM.iframeWrapper.addEventListener('touchend', e => {
                    const touchEndX = e.changedTouches[0].screenX;
                    const touchEndY = e.changedTouches[0].screenY;
                    const deltaX = touchEndX - state.touchStartX;
                    const deltaY = touchEndY - state.touchStartY;
                    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) { navigate(deltaX < 0 ? 1 : -1); }
                }, { passive: true });
                document.addEventListener('visibilitychange', _manageReloadTimer);
            };

            // --- 7. 初期化 ---
            // (変更なし)
            const init = () => {
                contentData.forEach((item, index) => {
                    const pcButton = document.createElement('button');
                    pcButton.textContent = item.title;
                    pcButton.onclick = () => changeContent(index);
                    DOM.contentButtonsWrapper.appendChild(pcButton);

                    const mobileListItem = document.createElement('div');
                    mobileListItem.className = 'list-item';
                    mobileListItem.textContent = item.title;
                    mobileListItem.onclick = () => {
                        changeContent(index);
                        DOM.listModal.classList.remove('visible');
                    };
                    DOM.listModalContent.appendChild(mobileListItem);
                });
                _setupEventListeners();
                if (contentData.length > 0) {
                    changeContent(0);
                }
            };

            return { init: init };
        })();

        document.addEventListener('DOMContentLoaded', App.init);
    </script>
</body>

</html>
